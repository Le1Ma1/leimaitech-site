<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>訂閱方案升級</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <main class="subscribe-section">
    <h2>選擇你的訂閱方案</h2>
    <div class="pricing-cards">
      <div class="pricing-card pro">
        <div class="badge badge-success">🎉 10 天免費試用</div>
        <h3>進階版 Pro</h3>
        <div class="price-row">
          <span class="price-main">NT$199</span><span class="price-sub">/月</span>
          <span class="price-divider">|</span>
          <span class="price-year">年繳 NT$1,999</span>
        </div>
        <ul class="features">
          <li>每日自動推播</li>
          <li>BTC/ETH/ETF 六分類</li>
          <li>持幣結構圖表</li>
          <li>全球資產排行</li>
          <li>獨家精華摘要</li>
        </ul>
        <button id="upgradeBtn" class="btn btn-upgrade">我要升級</button>
        <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <script>
        document.getElementById('upgradeBtn').onclick = async function() {
          await liff.init({ liffId: '2007745575-JPOMYKYn' });
          const profile = await liff.getProfile();
          const userId = profile.userId;
          const displayName = profile.displayName;
          // 你也可以用 liff.getDecodedIDToken() 拿 email
          // 發送訂單資料到後端
          fetch('/api/subscribe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              userId,
              displayName,
              plan: 'pro',     // 你的方案 key
              period: 'month', // 或 'year'
              email: ''        // 如果拿得到就傳
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.paymentUrl) {
              window.location.href = data.paymentUrl;
            } else {
              alert('訂單建立失敗');
            }
          });
        };
        </script>
        <div class="note">10天內隨時取消不收費</div>
      </div>
    </div>
  </main>
</body>
</html>
