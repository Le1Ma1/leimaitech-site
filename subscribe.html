<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>訂閱方案升級</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <main class="subscribe-section">
    <h2>選擇你的訂閱方案</h2>
    <div class="pricing-cards">
      <div class="pricing-card pro">
        <div class="badge badge-success">🎉 10 天免費試用</div>
        <h3>進階版 Pro</h3>
        <div class="price-row">
          <span class="price-main">NT$199</span><span class="price-sub">/月</span>
          <span class="price-divider">|</span>
          <span class="price-year">年繳 NT$1,999</span>
        </div>
        <ul class="features">
          <li>每日自動推播</li>
          <li>BTC/ETH/ETF 六分類</li>
          <li>持幣結構圖表</li>
          <li>全球資產排行</li>
          <li>獨家精華摘要</li>
        </ul>
        <button class="btn btn-upgrade" data-plan="pro" data-period="month">升級 Pro（月繳）</button>
        <button class="btn btn-upgrade" data-plan="pro" data-period="year">升級 Pro（年繳）</button>
        <button class="btn btn-upgrade btn-disabled" data-plan="elite" data-period="month" disabled>即將推出</button>
        <div class="note">10天內隨時取消不收費</div>
      </div>
    </div>
  </main>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    document.querySelectorAll('.btn-upgrade').forEach(btn => {
      if (!btn.disabled) {
        btn.addEventListener('click', async function() {
          await liff.init({ liffId: '2007745575-JPOMYKYn' });
          const profile = await liff.getProfile();
          const userId = profile.userId;
          const displayName = profile.displayName;
          const plan = this.getAttribute('data-plan');
          const period = this.getAttribute('data-period');
          fetch('/api/subscribe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              userId,
              displayName,
              plan,
              period,
              email: ''
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.paymentUrl) {
              window.location.href = data.paymentUrl;
            } else {
              alert('訂單建立失敗');
            }
          });
        });
      }
    });
  </script>
  </body>
  </html>
</body>
</html>
